@model SchoolEvents.ViewModels.CalendarVm
@{
    ViewData["Title"] = "Calendar";
    int daysInMonth = DateTime.DaysInMonth(Model.Year, Model.Month);
    DateTime firstDay = new DateTime(Model.Year, Model.Month, 1);
    int firstDayOfWeek = (int)firstDay.DayOfWeek; // Sunday=0
}

<div class="container py-4">

    <h1 class="fw-bold text-light mb-4 text-center">📅 @Model.Year - @Model.Month.ToString("D2") Calendar</h1>

    <!-- Calendar navigation -->
    <div class="d-flex justify-content-between mb-3">
        <a class="btn btn-outline-light"
           asp-action="Index"
           asp-route-year="@(Model.Month == 1 ? Model.Year - 1 : Model.Year)"
           asp-route-month="@(Model.Month == 1 ? 12 : Model.Month - 1)">
            &larr; Previous
        </a>
        <a class="btn btn-outline-light"
           asp-action="Index"
           asp-route-year="@(Model.Month == 12 ? Model.Year + 1 : Model.Year)"
           asp-route-month="@(Model.Month == 12 ? 1 : Model.Month + 1)">
            Next &rarr;
        </a>
    </div>

    <div class="calendar">
        <!-- Weekday headers -->
        <div class="calendar-row calendar-header">
            @foreach (var dayName in new[] { "Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat" })
            {
                <div class="calendar-cell text-light fw-bold">@dayName</div>
            }
        </div>

        <!-- Calendar days -->
        @{
            int day = 1;
            int totalCells = ((daysInMonth + firstDayOfWeek) <= 35 ? 35 : 42);
            for (int row = 0; row < totalCells / 7; row++)
            {
                <div class="calendar-row">
                    @for (int col = 0; col < 7; col++)
                    {
                        if ((row == 0 && col < firstDayOfWeek) || day > daysInMonth)
                        {
                            <div class="calendar-cell empty"></div>
                        }
                        else
                        {
                            var currentDate = new DateTime(Model.Year, Model.Month, day);
                            <div class="calendar-cell day">
                                <span class="day-number">@day</span>
                                <div class="events">
                                    @if (Model.EventsByDay.TryGetValue(currentDate, out var events))
                                    {
                                        foreach (var ev in events)
                                        {
                                            <div class="event-item">
                                                <span class="event-time">
                                                    @ev.StartAt.ToString("dd/MM HH:mm") - @ev.EndAt.ToString("dd/MM HH:mm")
                                                </span>
                                                <a asp-controller="Events" asp-action="Details" asp-route-id="@ev.Id" class="event-link">
                                                    @ev.Title
                                                </a>
                                            </div>
                                        }
                                    }
                                </div>
                            </div>
                            day++;
                        }
                    }
                </div>
            }
        }
    </div>

</div>

<style>
    .calendar {
        display: flex;
        flex-direction: column;
        gap: 4px;
    }

    .calendar-row {
        display: flex;
        gap: 4px;
    }

    .calendar-cell {
        flex: 1;
        min-height: 90px;
        background-color: var(--card-bg);
        border-radius: 0.25rem;
        border: 1px solid #3e5a7b;
        padding: 4px;
        display: flex;
        flex-direction: column;
        font-size: 0.85rem;
    }

        .calendar-cell.empty {
            background-color: #3e5a7b;
            border: 1px solid #2b4160;
        }

    .calendar-header .calendar-cell {
        background-color: var(--bg-main);
        text-align: center;
        display: flex;
        align-items: center;
        justify-content: center;
        min-height: 30px;
        font-size: 0.85rem;
    }

    .day-number {
        font-weight: 600;
        margin-bottom: 3px;
        font-size: 0.85rem;
    }

    .events {
        display: flex;
        flex-direction: column;
        gap: 2px;
        overflow-y: auto;
        flex-grow: 1;
    }

    .event-item {
        background-color: rgba(250,185,91,0.1);
        padding: 2px 4px;
        border-radius: 3px;
        display: flex;
        flex-direction: column;
    }

    .event-time {
        font-size: 0.7rem;
        color: #E8E2DB;
        font-weight: 500;
    }

    .event-link {
        font-size: 0.75rem;
        color: var(--accent);
        text-decoration: none;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

        .event-link:hover {
            color: #FFC966;
            text-decoration: underline;
        }

  
    .calendar-row .calendar-cell {
        aspect-ratio: 1 / 1;
    }

  
</style>
